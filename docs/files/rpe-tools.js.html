<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>rpe-tools.js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.5.1&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.5.1&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title=""></h1>
            
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/Logger.html">Logger</a></li>
            
                <li><a href="..&#x2F;classes/RPETools.html">RPETools</a></li>
            
                <li><a href="..&#x2F;classes/Storage.html">Storage</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/RPE.html">RPE</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: rpe-tools.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * @module RPE
 **&#x2F;

&#x2F;**
 * Data persistence &amp; logging utility for IBM Rational® Publishing Engine™.
 * Use in conjunction with RPE Persistence Server from Reportable Systems.
 *
 * Copyright 2012, ReportableSystems.com
 * http:&#x2F;&#x2F;www.reportablesystems.com
 *
 * NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.
 *
 * @class RPETools
 * @static
 **&#x2F;
var RPETools = (function() {

  &#x2F;**
   * A minified version of Douglas Crockford&#x27;s JSON library, for JS serialization.
   * See https:&#x2F;&#x2F;github.com&#x2F;douglascrockford&#x2F;JSON-js&#x2F;blob&#x2F;master&#x2F;json2.js
   *
   * @property JSON
   * @type Object
   *&#x2F;
  var JSON;if(!JSON){JSON={}}(function(){function f(a){return a&lt;10?&quot;0&quot;+a:a}function quote(a){escapable.lastIndex=0;return escapable.test(a)?&#x27;&quot;&#x27;+a.replace(escapable,function(a){var b=meta[a];return typeof b===&quot;string&quot;?b:&quot;\\u&quot;+(&quot;0000&quot;+a.charCodeAt(0).toString(16)).slice(-4)})+&#x27;&quot;&#x27;:&#x27;&quot;&#x27;+a+&#x27;&quot;&#x27;}function str(a,b){var c,d,e,f,g=gap,h,i=b[a];if(i&amp;&amp;typeof i===&quot;object&quot;&amp;&amp;typeof i.toJSON===&quot;function&quot;){i=i.toJSON(a)}if(typeof rep===&quot;function&quot;){i=rep.call(b,a,i)}switch(typeof i){case&quot;string&quot;:return quote(i);case&quot;number&quot;:return isFinite(i)?String(i):&quot;null&quot;;case&quot;boolean&quot;:case&quot;null&quot;:return String(i);case&quot;object&quot;:if(!i){return&quot;null&quot;}gap+=indent;h=[];if(Object.prototype.toString.apply(i)===&quot;[object Array]&quot;){f=i.length;for(c=0;c&lt;f;c+=1){h[c]=str(c,i)||&quot;null&quot;}e=h.length===0?&quot;[]&quot;:gap?&quot;[\n&quot;+gap+h.join(&quot;,\n&quot;+gap)+&quot;\n&quot;+g+&quot;]&quot;:&quot;[&quot;+h.join(&quot;,&quot;)+&quot;]&quot;;gap=g;return e}if(rep&amp;&amp;typeof rep===&quot;object&quot;){f=rep.length;for(c=0;c&lt;f;c+=1){if(typeof rep[c]===&quot;string&quot;){d=rep[c];e=str(d,i);if(e){h.push(quote(d)+(gap?&quot;: &quot;:&quot;:&quot;)+e)}}}}else{for(d in i){if(Object.prototype.hasOwnProperty.call(i,d)){e=str(d,i);if(e){h.push(quote(d)+(gap?&quot;: &quot;:&quot;:&quot;)+e)}}}}e=h.length===0?&quot;{}&quot;:gap?&quot;{\n&quot;+gap+h.join(&quot;,\n&quot;+gap)+&quot;\n&quot;+g+&quot;}&quot;:&quot;{&quot;+h.join(&quot;,&quot;)+&quot;}&quot;;gap=g;return e}}&quot;use strict&quot;;if(typeof Date.prototype.toJSON!==&quot;function&quot;){Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+&quot;-&quot;+f(this.getUTCMonth()+1)+&quot;-&quot;+f(this.getUTCDate())+&quot;T&quot;+f(this.getUTCHours())+&quot;:&quot;+f(this.getUTCMinutes())+&quot;:&quot;+f(this.getUTCSeconds())+&quot;Z&quot;:null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()}}var cx=&#x2F;[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]&#x2F;g,escapable=&#x2F;[\\\&quot;\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]&#x2F;g,gap,indent,meta={&quot;\b&quot;:&quot;\\b&quot;,&quot;    &quot;:&quot;\\t&quot;,&quot;\n&quot;:&quot;\\n&quot;,&quot;\f&quot;:&quot;\\f&quot;,&quot;\r&quot;:&quot;\\r&quot;,&#x27;&quot;&#x27;:&#x27;\\&quot;&#x27;,&quot;\\&quot;:&quot;\\\\&quot;},rep;if(typeof JSON.stringify!==&quot;function&quot;){JSON.stringify=function(a,b,c){var d;gap=&quot;&quot;;indent=&quot;&quot;;if(typeof c===&quot;number&quot;){for(d=0;d&lt;c;d+=1){indent+=&quot; &quot;}}else if(typeof c===&quot;string&quot;){indent=c}rep=b;if(b&amp;&amp;typeof b!==&quot;function&quot;&amp;&amp;(typeof b!==&quot;object&quot;||typeof b.length!==&quot;number&quot;)){throw new Error(&quot;JSON.stringify&quot;)}return str(&quot;&quot;,{&quot;&quot;:a})}}if(typeof JSON.parse!==&quot;function&quot;){JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&amp;&amp;typeof e===&quot;object&quot;){for(c in e){if(Object.prototype.hasOwnProperty.call(e,c)){d=walk(e,c);if(d!==undefined){e[c]=d}else{delete e[c]}}}}return reviver.call(a,b,e)}var j;text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return&quot;\\u&quot;+(&quot;0000&quot;+a.charCodeAt(0).toString(16)).slice(-4)})}if(&#x2F;^[\],:{}\s]*$&#x2F;.test(text.replace(&#x2F;\\(?:[&quot;\\\&#x2F;bfnrt]|u[0-9a-fA-F]{4})&#x2F;g,&quot;@&quot;).replace(&#x2F;&quot;[^&quot;\\\n\r]*&quot;|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?&#x2F;g,&quot;]&quot;).replace(&#x2F;(?:^|:|,)(?:\s*\[)+&#x2F;g,&quot;&quot;))){j=eval(&quot;(&quot;+text+&quot;)&quot;);return typeof reviver===&quot;function&quot;?walk({&quot;&quot;:j},&quot;&quot;):j}throw new SyntaxError(&quot;JSON.parse&quot;)}}})();

  &#x2F;**
   * The hostname or IP address of the RPE Persistence Server.
   *
   * @property host
   * @type String
   * @default &quot;localhost&quot;
   *&#x2F;
  var host = &quot;localhost&quot;;

  &#x2F;**
   * The port number of the RPE Persistence Server.
   *
   * @property port
   * @type Number
   * @default 27465
   *&#x2F;
  var port = 27465;
  &#x2F;**
   * The base URI for communicating with the RPE Persistence Server service.
   *
   * @property serviceURI
   * @type String
   * @default &quot;http:&#x2F;&#x2F;localhost:27465&#x2F;&quot;
   *&#x2F;
  var serviceURI = &quot;http:&#x2F;&#x2F;&quot; + host + &quot;:&quot; + port + &quot;&#x2F;&quot;;

  &#x2F;**
   * Invokes an HTTP GET request using Mozilla Rhino &#x2F; Java class wrapping.
   *
   * @method get
   * @private
   * @param url {String} A well-formed, validly encoded URL.
   * @return {String} The content of the HTTP response.
   *&#x2F;
  function get(url){
    buf = &quot;&quot;, line = &quot;&quot;;
    try{
      var bis = new java.io.BufferedReader(new java.io.InputStreamReader(new java.net.URL(url).openConnection().getInputStream()));
      while((line=bis.readLine())!=null){
        buf+=line;
      }
      bis.close();
    }catch(error){
      java.lang.System.out.println(&quot;RPETools.js Exception: &quot; + error);
    };
    return buf;
  };

  &#x2F;**
   * Generates a 36 character UID-like identifier String; e.g. &quot;77a04516-18b4-5be5-12ee-4bb256ebae9e&quot;.
   *
   * @method uid
   * @private
   * @return {String} A new UID-like identifier.
   *&#x2F;
  function uid(){
    var S4 = function() {
      return (((1+Math.random())*0x10000)|0).toString(16).substring(1);
    };
    return (S4()+S4()+&quot;-&quot;+S4()+&quot;-&quot;+S4()+&quot;-&quot;+S4()+&quot;-&quot;+S4()+S4()+S4());
  };

  &#x2F;**
   * Allocates a file using Mozilla Rhino &#x2F; Java class wrapping.
   *
   * @method getFile
   * @private
   * @param filename {String} A fully-qualified filepath and filename descriptor.
   * @return {java.io.File}
   *&#x2F;
  function getFile(filename){
    var f = new java.io.File(filename);
    if(!f.exists()){
      f.createNewFile();
    }
    return f;
  };

  &#x2F;**
   * Writes content to a file using Mozilla Rhino &#x2F; Java class wrapping.
   *
   * @method writeToFile
   * @private
   * @param filename {String} A fully-qualified filepath and filename descriptor.
   * @param content {String} A fully-qualified filepath and filename descriptor.
   * @param [append=false] {Boolean} A flag that adjusts the write mode (append to existing file, or overwrite).
   *&#x2F;
  function writeToFile(){
    var filename = (arguments[0]) ? arguments[0] : &quot;&quot;;
    var content = (arguments[1]) ? arguments[1] : &quot;&quot;;
    var append = (arguments[2]) ? arguments[2] : false;
    var f = getFile(filename);
    var fstream = new java.io.FileWriter(f,append);
    var out = new java.io.BufferedWriter(fstream);
    out.write(content);
    out.close();
  };

  &#x2F;**
   * Overrides default hostname and port configuration settings for the RPE Persistence Server.
   *
   * @method setHost
   * @param host {String} The IP address or hostname where the RPE Persistence Server service is running.
   * @param port {Number} The port number that the RPE Persistence Server service is bound to.
   * @example
       RPETools.setHost(&quot;10.0.2.5&quot;,27465);
   **&#x2F;
  function setHost(){
    host = (arguments[0]) ? arguments[0] : &quot;localhost&quot;;
    port = (arguments[1]) ? arguments[1] : 27465;
    serviceURI = &quot;http:&#x2F;&#x2F;&quot; + host + &quot;:&quot; + port + &quot;&#x2F;&quot;;
  }

  &#x2F;**
   * The Storage class is used to persist variables across multiple RPE templates.
   *
   * @class Storage
   * @static
   *&#x2F;
  var Storage = (function() {

    &#x2F;**
     * Retrieves then de-serializes the content of the named variable from the RPE Persistence Server.
     *
     * @method read
     * @param name {String} The name of the desired stored variable.
     * @return {Boolean|Number|String|Array|Object} The value of the stored variable on the RPE Persistence Server.
     * @example
        &#x2F;&#x2F; retrieve value of myVariable from RPE Persistence Server...
        var myVariable = RPETools.Storage.read(&quot;myVariable&quot;);
     *&#x2F;
    function read(){
      var name = (arguments[0]) ? arguments[0] : &quot;&quot;;
      var result = &quot;&quot;;
      if(name!=&quot;&quot;){
        request = serviceURI + &quot;storage&#x2F;read?name=&quot; + encodeURIComponent(name);
        try{
          result = JSON.parse(decodeURIComponent(get(request)));
          java.lang.System.out.println(&quot;RPETools.js: read variable &#x27;&quot; + name + &quot;&#x27; from Storage.&quot;);
        }catch(error){
          java.lang.System.out.println(&quot;RPETools.js Exception: Requested variable not found on server, or is corrupted. Empty string returned.&quot;);
        };
      }else{
        throw new Error(&quot;RPETools.js Exception: RPETools.Storage.read(): First argument (name) was missing.&quot;);
      };
      return result;
    };

    &#x2F;**
     * Serializes then stores a variable on the RPE Persistence Server; overwrites if the named variable already exists.
     *
     * @method write
     * @param name {String} The name of the variable to store.
     * @param value {Boolean|Number|String|Array|Object} The value to be assigned to the named variable.
     * @return {Boolean|Number|String|Array|Object} The original value.
     * @example
        &#x2F;&#x2F; store some simple JS vars...
        RPETools.Storage.write(&quot;myBooleanVariable&quot;,true);
        RPETools.Storage.write(&quot;myNumericVariable&quot;,256);
        RPETools.Storage.write(&quot;myStringVariable&quot;,&quot;Some string.&quot;);

        &#x2F;&#x2F; store an array &amp; simple JS object...
        RPETools.Storage.write(&quot;myArrayVariable&quot;,[&quot;Audi&quot;,&quot;BMW&quot;,&quot;Jaguar&quot;]);
        RPETools.Storage.write(&quot;myLiteralVariable&quot;,{&quot;host&quot;:&quot;localhost&quot;,&quot;port&quot;:&quot;27465&quot;});

        &#x2F;&#x2F; store a more complex JS object...
        var myObjectVariable = {
          name: &quot;Test Object&quot;,
          someArrayNumbers: [1,2,3],
          aFlag : true,
          aNestedObject : {
            name : &quot;Test Object&#x27;s Nested Object&quot;
          }
        };
        RPETools.Storage().write(&quot;anObjectVariable&quot;,myObjectVariable);
     *&#x2F;
    function write(){
      var name = (arguments[0]) ? arguments[0] : &quot;&quot;;
      var value = (arguments[1]) ? arguments[1] : &quot;&quot;;
      var result = &quot;&quot;;
      if(name!=&quot;&quot;){
        request = serviceURI + &quot;storage&#x2F;write?name=&quot; + encodeURIComponent(name) + &quot;&amp;value=&quot; + encodeURIComponent(JSON.stringify(value));
        get(request);
        java.lang.System.out.println(&quot;RPETools.js: write variable &#x27;&quot; + name + &quot;&#x27; to Storage.&quot;);
        result = value; &#x2F;&#x2F; for expediency, simply return the value param
      }else{
        throw new Error(&quot;RPETools.js Exception: RPETools.Storage.write(): First argument (name) was missing.&quot;);
      };
      return result;
    };

    &#x2F;**
     * Clears all variables from the RPE Persistence Server.
     *
     * @method reset
     * @return {String} An empty string.
     * @example
        RPETools.Storage.reset();
     *&#x2F;
    function reset(){
      request = serviceURI + &quot;storage&#x2F;reset&quot;;
      get(request);
      java.lang.System.out.println(&quot;RPETools.js: reset Storage.&quot;);
      return &quot;&quot;;
    };

    &#x2F;**
     * Saves to disk an XML representation of all variables stored on the RPE Persistence Server.
     *
     * @method saveXML
     * @param filename {String} The target filename to which XML content is written.
     * @return {String} An XML representation of all variables stored on the RPE Persistence Server.
     * @example
        RPETools.Storage.saveXML(&quot;c:\\temp\\storage.xml&quot;);
     *&#x2F;
    function saveXML(){
      var filename = (arguments[0]) ? arguments[0] : &quot;&quot;;
      request = serviceURI + &quot;storage&#x2F;view&quot;;
      var result = &quot;&quot;;
      result = get(request);
      try{
        writeToFile(filename,result);
        java.lang.System.out.println(&quot;RPETools.js: write Storage XML to file &#x27;&quot; + filename + &quot;&#x27;.&quot;);
      }catch(error){
        java.lang.System.out.println(&quot;RPETools.js Exception: &quot; + error);
      };
      return result;
    };

    &#x2F;&#x2F; Return publicly accessible functions for the Storage module.
    return {
      read : read,
      write : write,
      reset : reset,
      saveXML : saveXML
    };
  })();

  &#x2F;**
   * The Logger class is used to manage publishing logs for non-trivial RPE templates.
   *
   * @class Logger
   * @static
   *&#x2F;
  var Logger = (function() {

    &#x2F;**
     * Records (and optionally tags) a log message to the RPE Persistence Server.
     *
     * @method log
     * @param msg {String} The content of the log message to be stored.
     * @param [tag=&quot;&quot;] {String} An optional String that can be used to identify related log messages.
     * @return {String} A 36 character ID generated for the logged message, to use with an RPE Bookmark element.
     * @example
        &#x2F;&#x2F; record a simple log message
        var bookmark = RPETools.Logger.log(&quot;The requested Rhapsody package could not be found.&quot;);

        &#x2F;&#x2F; record a log message tagged &quot;DOORS&quot;
        var bookmark = RPETools.Logger.log(&quot;Expected DOORS module attribute not found.&quot;,&quot;DOORS&quot;);
     *&#x2F;
    function log(){
      var msg = (arguments[0]) ? arguments[0] : &quot;&quot;;
      var tag = (arguments[1]) ? arguments[1] : &quot;&quot;;
      var result = &quot;&quot;;
      if(msg!=&quot;&quot;){
        request = serviceURI + &quot;logger&#x2F;log?uid=&quot; + uid() + &quot;&amp;msg=&quot; + encodeURIComponent(msg);
        if(tag!=&quot;&quot;){
          request += &quot;&amp;tag=&quot; + encodeURIComponent(tag);
        };
        result = decodeURIComponent(get(request));
        java.lang.System.out.println(&quot;RPETools.js: log message with ID &#x27;&quot; + result + &quot;&#x27; saved to Logger.&quot;);
      }else{
        throw new Error(&quot;RPETools.js Exception: RPETools.Logger.log(): First argument (message) was missing.&quot;);
      };
      return result;
    };

    &#x2F;**
     * Clears all log entries from the RPE Persistence Server.
     *
     * @method reset
     * @return {String} Empty string.
     * @example
        RPETools.Logger.reset();
     *&#x2F;
    function reset(){
      request = serviceURI + &quot;logger&#x2F;reset&quot;;
      get(request);
      java.lang.System.out.println(&quot;RPETools.js: reset Logger.&quot;);
      return &quot;&quot;;
    };

    &#x2F;**
     * Saves to disk an XML representation of all logged messages on the RPE Persistence Server.
     *
     * @method saveXML
     * @param filename {String} The target filename to which XML content is written.
     * @return {String} An XML representation of all logged messages on the RPE Persistence Server.
     * @example
        RPETools.Logger.saveXML(&quot;c:\\temp\\logger.xml&quot;);
     *&#x2F;
    function saveXML(){
      var filename = (arguments[0]) ? arguments[0] : &quot;&quot;;
      request = serviceURI + &quot;logger&#x2F;view&quot;;
      var result = &quot;&quot;;
      result = get(request);
      try{
        writeToFile(filename,result);
        java.lang.System.out.println(&quot;RPETools.js: write Logger XML to file &#x27;&quot; + filename + &quot;&#x27;.&quot;);
      }catch(error){
        java.lang.System.out.println(&quot;RPETools.js Exception: &quot; + error);
      };
      return result;
    };

    &#x2F;&#x2F; Return publicly accessible functions for the Logger module.
    return {
      log : log,
      reset : reset,
      saveXML : saveXML
    };
  })();

  &#x2F;&#x2F; Return access functions for the Storage and Logger classes, and to the setHost() function for overriding the default hostname and port configuration settings for the RPE Persistence Server.
  return{
    Storage : Storage,
    Logger : Logger,
    setHost : setHost
  };
})();
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
